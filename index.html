<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starlink Command Center V7</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            color: #e2e8f0;
            overflow: hidden;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .tab-active {
            color: #3b82f6;
            border-bottom: 2px solid #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .glass {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(51, 65, 85, 0.5);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }

        /* Grid Map for Coverage */
        .hex-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(20px, 1fr));
            gap: 2px;
        }

        .hex {
            height: 20px;
            background: #1e293b;
            transition: all 0.3s;
        }

        .hex.active {
            background: #3b82f6;
            box-shadow: 0 0 5px #3b82f6;
        }

        .hex.partial {
            background: #0f766e;
        }

        /* Weather Bar Animation */
        @keyframes pulse-bar {
            0% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.6;
            }
        }

        .bar-pulse {
            animation: pulse-bar 2s infinite;
        }
    </style>
</head>

<body class="h-screen flex flex-col">

    <!-- HEADER -->
    <header class="h-16 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-900/80 z-50 shrink-0">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="text-white">
                    <path d="M12 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" />
                    <path d="m21 9-9-7-9 7" />
                    <path d="M3 5v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5" />
                </svg>
            </div>
            <div>
                <h1 class="font-bold text-lg tracking-tight text-white">STARLINK <span class="text-blue-500">CMD</span>
                </h1>
                <p class="text-[10px] text-slate-500 font-mono tracking-widest">V7.0.1 STABLE</p>
            </div>
        </div>

        <nav class="flex gap-2">
            <button onclick="switchTab('monitor')" id="btn-monitor"
                class="px-6 py-2 text-xs font-bold rounded-lg tab-active transition-all">MONITOR</button>
            <button onclick="switchTab('coverage')" id="btn-coverage"
                class="px-6 py-2 text-xs font-bold rounded-lg text-slate-500 hover:text-slate-300 hover:bg-slate-800 transition-all">COVERAGE</button>
            <button onclick="switchTab('weather')" id="btn-weather"
                class="px-6 py-2 text-xs font-bold rounded-lg text-slate-500 hover:text-slate-300 hover:bg-slate-800 transition-all">WEATHER</button>
            <button onclick="switchTab('fleet')" id="btn-fleet"
                class="px-6 py-2 text-xs font-bold rounded-lg text-slate-500 hover:text-slate-300 hover:bg-slate-800 transition-all">FLEET</button>
            <button onclick="switchTab('ai')" id="btn-ai"
                class="px-6 py-2 text-xs font-bold rounded-lg text-slate-500 hover:text-slate-300 hover:bg-slate-800 transition-all">AI
                ASSISTANT</button>
        </nav>

        <div class="flex items-center gap-6">
            <div class="text-right">
                <p class="text-[10px] text-slate-500 font-mono">UPLINK STATUS</p>
                <p class="text-xs font-bold text-green-500 flex items-center justify-end gap-1">
                    <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span> SECURE
                </p>
            </div>
        </div>
    </header>

    <main class="flex-1 flex p-6 gap-6 overflow-hidden">

        <!-- LEFT PANEL -->
        <aside class="w-72 flex flex-col gap-4 shrink-0">
            <!-- Stats -->
            <div class="glass p-5 rounded-2xl space-y-4">
                <h3 class="text-[10px] font-bold text-slate-500 tracking-widest mb-2 font-mono">ORBITAL METRICS</h3>
                <div class="flex justify-between items-end border-b border-slate-700/50 pb-2">
                    <span class="text-xs text-slate-400">Velocity</span>
                    <span id="stat-speed" class="text-sm font-bold font-mono text-white">27,412 km/h</span>
                </div>
                <div class="flex justify-between items-end">
                    <span class="text-xs text-slate-400">Latency</span>
                    <span id="stat-latency" class="text-sm font-bold font-mono text-green-400">22.4 ms</span>
                </div>
            </div>

            <!-- Activity Log -->
            <div class="glass flex-1 rounded-2xl p-5 flex flex-col overflow-hidden min-h-[150px]">
                <h3 class="text-[10px] font-bold text-slate-500 tracking-widest mb-3 font-mono">SYSTEM LOGS</h3>
                <div id="log-container"
                    class="flex-1 overflow-y-auto space-y-2 text-[10px] font-mono text-slate-400 pr-2">
                    <p class="text-blue-400">> Initializing V7 Core...</p>
                    <p>> Laser Mesh topology mapped</p>
                    <p>> Ground Station [SEOUL-01] synced</p>
                </div>
            </div>

            <!-- Network Status -->
            <div class="glass p-5 rounded-2xl border-t-2 border-blue-500">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-[10px] font-bold text-blue-400 tracking-widest font-mono">NETWORK HEALTH</h3>
                    <div class="w-2 h-2 bg-blue-500 rounded-full animate-ping"></div>
                </div>

                <div class="space-y-3">
                    <div>
                        <div class="flex justify-between text-[10px] mb-1">
                            <span class="text-slate-400">Laser Link Mesh</span>
                            <span class="text-green-400 font-bold">98.2%</span>
                        </div>
                        <div class="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-blue-500 h-full w-[98%]"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-2 mt-2">
                        <div class="bg-slate-800/50 p-2 rounded text-center border border-slate-700">
                            <p class="text-[9px] text-slate-500">GATEWAYS</p>
                            <p class="text-xs font-bold text-white">142</p>
                        </div>
                        <div class="bg-slate-800/50 p-2 rounded text-center border border-slate-700">
                            <p class="text-[9px] text-slate-500">CAPACITY</p>
                            <p class="text-xs font-bold text-white">42 Tbps</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- CENTER CONTENT -->
        <div class="flex-1 glass rounded-[32px] overflow-hidden relative border-slate-700/30">

            <!-- TAB: MONITOR -->
            <div id="tab-monitor" class="w-full h-full relative">
                <div id="canvas-container" class="w-full h-full"></div>
                <div class="absolute bottom-8 left-8">
                    <div
                        class="flex items-center gap-3 bg-black/40 px-4 py-2 rounded-full border border-white/10 backdrop-blur">
                        <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                        <span class="text-[10px] font-bold text-slate-300 tracking-widest">LIVE ORBITAL FEED</span>
                    </div>
                </div>
            </div>

            <!-- TAB: COVERAGE -->
            <div id="tab-coverage" class="hidden w-full h-full p-8 flex flex-col">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-white tracking-tight">Global Service Coverage</h2>
                        <p class="text-sm text-slate-400 mt-1">Real-time availability heatmap & active cells</p>
                    </div>
                    <div class="flex gap-4 text-xs font-mono">
                        <span class="flex items-center gap-2"><span class="w-3 h-3 bg-blue-500 rounded-sm"></span> HIGH
                            SPEED</span>
                        <span class="flex items-center gap-2"><span class="w-3 h-3 bg-teal-600 rounded-sm"></span>
                            STANDARD</span>
                        <span class="flex items-center gap-2"><span class="w-3 h-3 bg-slate-800 rounded-sm"></span> NO
                            SERVICE</span>
                    </div>
                </div>

                <div class="flex-1 bg-black/20 rounded-2xl border border-slate-700/50 p-4 relative overflow-hidden">
                    <div id="coverage-grid" class="hex-grid w-full h-full absolute inset-0 p-4 opacity-80"></div>
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <h3 class="text-6xl font-black text-white/5 tracking-widest">GLOBAL GRID</h3>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-6 mt-6">
                    <div class="bg-slate-800/40 p-4 rounded-xl border border-slate-700">
                        <p class="text-xs text-slate-500 mb-1">ACTIVE USERS</p>
                        <p class="text-2xl font-bold text-white">2,841,022</p>
                    </div>
                    <div class="bg-slate-800/40 p-4 rounded-xl border border-slate-700">
                        <p class="text-xs text-slate-500 mb-1">COVERAGE AREA</p>
                        <p class="text-2xl font-bold text-white">84.2%</p>
                    </div>
                    <div class="bg-slate-800/40 p-4 rounded-xl border border-slate-700">
                        <p class="text-xs text-slate-500 mb-1">WAITLIST</p>
                        <p class="text-2xl font-bold text-white">410,391</p>
                    </div>
                </div>
            </div>

            <!-- TAB: WEATHER -->
            <div id="tab-weather" class="hidden w-full h-full p-8 overflow-y-auto">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-2xl font-bold text-white tracking-tight">Space Weather Monitoring</h2>
                        <p class="text-sm text-slate-400 mt-1">Solar activity & orbital debris risk assessment</p>
                    </div>
                    <div
                        class="px-4 py-2 bg-green-900/30 border border-green-500/30 rounded-lg text-green-400 text-xs font-bold">
                        CONDITION: STABLE
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-8">
                    <div class="bg-slate-800/30 p-6 rounded-2xl border border-slate-700">
                        <h3 class="text-sm font-bold text-yellow-400 mb-6 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="5" />
                                <path
                                    d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                            </svg>
                            SOLAR WIND INDEX
                        </h3>
                        <div class="flex items-end gap-2 h-40">
                            <div class="w-full bg-slate-700/50 rounded-lg overflow-hidden relative">
                                <canvas id="solarChart"></canvas>
                            </div>
                        </div>
                        <div class="flex justify-between mt-4 text-xs text-slate-400">
                            <span>Density: 4.2 p/cm³</span>
                            <span>Speed: 380 km/s</span>
                        </div>
                    </div>

                    <div class="bg-slate-800/30 p-6 rounded-2xl border border-slate-700">
                        <h3 class="text-sm font-bold text-red-400 mb-6 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
                                <path d="M12 9v4" />
                                <path d="M12 17h.01" />
                            </svg>
                            DEBRIS COLLISION RISK
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span>LEO Zone A (550km)</span>
                                    <span class="text-green-400">Low</span>
                                </div>
                                <div class="w-full bg-slate-900 h-2 rounded-full overflow-hidden">
                                    <div class="bg-green-500 h-full w-[12%] bar-pulse"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span>Polar Orbit Lane</span>
                                    <span class="text-yellow-400">Moderate</span>
                                </div>
                                <div class="w-full bg-slate-900 h-2 rounded-full overflow-hidden">
                                    <div class="bg-yellow-500 h-full w-[45%] bar-pulse" style="animation-delay: 0.5s">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span>Insertion Orbit</span>
                                    <span class="text-green-400">Low</span>
                                </div>
                                <div class="w-full bg-slate-900 h-2 rounded-full overflow-hidden">
                                    <div class="bg-green-500 h-full w-[8%] bar-pulse" style="animation-delay: 1s"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 p-3 bg-red-900/20 border border-red-500/20 rounded-lg text-xs text-red-300">
                            ⚠ No immediate collision threats detected in the next 24h window.
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: FLEET -->
            <div id="tab-fleet" class="hidden w-full h-full p-8 overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Satellite Fleet Inventory</h2>
                    <div class="flex gap-2">
                        <span class="px-3 py-1 bg-blue-500/20 text-blue-400 rounded text-xs font-bold">V2.0 MINI:
                            842</span>
                        <span class="px-3 py-1 bg-purple-500/20 text-purple-400 rounded text-xs font-bold">V1.5:
                            3,201</span>
                    </div>
                </div>
                <!-- Fixed ID here: from fleet-grid to fleet-list -->
                <div id="fleet-list" class="grid grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>

            <!-- TAB: AI -->
            <div id="tab-ai" class="hidden w-full h-full flex flex-col p-8">
                <div class="mb-4">
                    <h2 class="text-2xl font-bold">Neural Link AI</h2>
                    <p class="text-sm text-slate-500">Authorized Personnel Only. Ask technical queries.</p>
                </div>
                <div id="ai-chat-box" class="flex-1 overflow-y-auto mb-4 space-y-4 pr-2">
                    <div
                        class="bg-slate-800/50 p-4 rounded-2xl border border-slate-700/50 text-sm text-slate-300 w-fit">
                        시스템 접속 완료. 궤도 역학, 커버리지, 기상 데이터에 대해 질문하십시오.
                    </div>
                </div>
                <div
                    class="flex gap-3 bg-black/40 p-3 rounded-2xl border border-slate-700 focus-within:border-blue-500 transition-all">
                    <input type="text" id="ai-input"
                        class="flex-1 bg-transparent border-none outline-none px-2 text-sm text-white"
                        placeholder="명령어 입력...">
                    <button onclick="askAI()"
                        class="bg-blue-600 px-6 py-2 rounded-xl text-sm font-bold hover:bg-blue-500 transition-all">EXECUTE</button>
                </div>
            </div>

        </div>
    </main>

    <script>
        const apiKey = "";

        // --- 3D EARTH LOGIC ---
        function init3D() {
            const container = document.getElementById('canvas-container');
            if (!container) return;
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });

            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            const geometry = new THREE.SphereGeometry(3, 40, 40);
            const material = new THREE.MeshPhongMaterial({
                color: 0x3b82f6, wireframe: true, transparent: true, opacity: 0.3
            });
            const earth = new THREE.Mesh(geometry, material);
            scene.add(earth);

            const core = new THREE.Mesh(
                new THREE.SphereGeometry(2.95, 32, 32),
                new THREE.MeshBasicMaterial({ color: 0x020617 })
            );
            scene.add(core);

            const satellites = [];
            for (let i = 0; i < 50; i++) {
                const s = new THREE.Mesh(
                    new THREE.SphereGeometry(0.04, 8, 8),
                    new THREE.MeshBasicMaterial({ color: 0xffffff })
                );
                const orbit = {
                    r: 3.5 + Math.random(),
                    speed: 0.002 + Math.random() * 0.005,
                    theta: Math.random() * Math.PI * 2,
                    phi: Math.random() * Math.PI
                };
                satellites.push({ mesh: s, ...orbit });
                scene.add(s);
            }

            const light = new THREE.DirectionalLight(0xffffff, 1.5);
            light.position.set(5, 3, 5);
            scene.add(light);

            camera.position.z = 12;

            function animate() {
                requestAnimationFrame(animate);
                earth.rotation.y += 0.001;
                satellites.forEach(s => {
                    s.theta += s.speed;
                    s.mesh.position.x = s.r * Math.sin(s.phi) * Math.cos(s.theta);
                    s.mesh.position.y = s.r * Math.cos(s.phi);
                    s.mesh.position.z = s.r * Math.sin(s.phi) * Math.sin(s.theta);
                });
                renderer.render(scene, camera);
            }
            animate();
        }

        // --- CHART LOGIC ---
        function initCharts() {
            const canvas = document.getElementById('solarChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                    datasets: [{
                        label: 'Solar Flux',
                        data: [65, 72, 68, 75, 82, 78],
                        borderColor: '#facc15',
                        backgroundColor: 'rgba(250, 204, 21, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { display: false, min: 50 },
                        x: { display: false }
                    }
                }
            });
        }

        // --- GRID LOGIC ---
        function initGrid() {
            const grid = document.getElementById('coverage-grid');
            if (!grid) return;
            grid.innerHTML = '';

            for (let i = 0; i < 400; i++) {
                const r = Math.random();      // ✅ 랜덤 1번만 뽑음
                const div = document.createElement('div');
                div.className = 'hex';

                if (r > 0.7) div.classList.add('active');        // 30%
                else if (r > 0.5) div.classList.add('partial');  // 20%
                // else none = 50%

                grid.appendChild(div);
            }
        }


        // --- TAB LOGIC ---
        function switchTab(id) {
            // 버튼 스타일
            document.querySelectorAll('nav button').forEach(b => {
                b.classList.remove('tab-active', 'text-white');
                b.classList.add('text-slate-500');
            });

            const activeBtn = document.getElementById(`btn-${id}`);
            if (activeBtn) {
                activeBtn.classList.add('tab-active', 'text-white');
                activeBtn.classList.remove('text-slate-500');
            }

            // 탭 표시
            document.querySelectorAll('[id^="tab-"]').forEach(d => d.classList.add('hidden'));
            const activeTab = document.getElementById(`tab-${id}`);
            if (activeTab) activeTab.classList.remove('hidden');

            // ✅ 현재 탭을 URL에 저장
            location.hash = id;

            // (원하면 탭별 init도 여기서)
            if (id === 'coverage') initGrid();
            if (id === 'fleet') initFleet();
            if (id === 'weather') initCharts();
        }


        // --- FLEET LOGIC (Fixed reference to fleet-list) ---
        function initFleet() {
            const list = document.getElementById('fleet-list');
            if (!list) return; // Prevent TypeError if element doesn't exist
            list.innerHTML = '';
            for (let i = 0; i < 12; i++) {
                list.innerHTML += `
                    <div class="bg-slate-800/40 p-4 rounded-xl border border-slate-700/50 flex justify-between items-center group hover:border-blue-500 transition-colors">
                        <div>
                            <p class="text-xs font-bold text-white group-hover:text-blue-400">STARLINK-${1000 + i}</p>
                            <p class="text-[10px] text-slate-500 font-mono">ALT: 550.2KM</p>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] text-green-500 font-bold">ONLINE</p>
                            <p class="text-[10px] text-slate-500">Vel: 7.6 km/s</p>
                        </div>
                    </div>
                `;
            }
        }

        // --- AI LOGIC ---
        async function askAI() {
            const input = document.getElementById('ai-input');
            const chat = document.getElementById('ai-chat-box');
            if (!input || !chat) return;
            const text = input.value.trim();
            if (!text) return;

            chat.innerHTML += `<div class="flex justify-end"><div class="bg-blue-600 p-4 rounded-2xl rounded-tr-none text-white text-sm max-w-[80%]">${text}</div></div>`;
            input.value = "";
            chat.scrollTop = chat.scrollHeight;

            const loadId = 'load-' + Date.now();
            chat.innerHTML += `<div id="${loadId}" class="bg-slate-800/50 p-4 rounded-2xl rounded-tl-none border border-slate-700/50 text-sm text-slate-500 italic">분석 중...</div>`;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: text + " (스타링크 운영자로서 한국어로 전문적이고 짧게 답변)" }] }],
                        systemInstruction: { parts: [{ text: "You are an expert Starlink satellite operations commander." }] }
                    })
                });
                const data = await res.json();
                const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "명령 처리에 실패했습니다.";
                const loadEl = document.getElementById(loadId);
                if (loadEl) {
                    loadEl.innerText = reply;
                    loadEl.classList.remove('italic', 'text-slate-500');
                    loadEl.classList.add('text-slate-300');
                }
            } catch (e) {
                const loadEl = document.getElementById(loadId);
                if (loadEl) loadEl.innerText = "통신 오류가 발생했습니다.";
            }
            chat.scrollTop = chat.scrollHeight;
        }

        // --- INIT ---
        window.onload = () => {
            init3D();

            // ✅ 새로고침해도 마지막 탭 유지
            const saved = location.hash.replace('#', '');
            const firstTab = ['monitor', 'coverage', 'weather', 'fleet', 'ai'].includes(saved) ? saved : 'monitor';
            switchTab(firstTab);

            // 나머지
            const aiInput = document.getElementById('ai-input');
            if (aiInput) aiInput.addEventListener('keypress', (e) => e.key === 'Enter' && askAI());

            setInterval(() => {
                const speedEl = document.getElementById('stat-speed');
                if (speedEl) {
                    speedEl.innerText = (27400 + Math.random() * 50).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " km/h";
                }
            }, 1000);
        };

    </script>
</body>

</html>
